```python
import pandas as pd
import os, shutil
import time
import tensorflow as tf
from tensorflow.keras import layers, models
from tensorflow.keras.preprocessing.image import ImageDataGenerator
from tensorflow.keras.optimizers import Adam, Nadam, SGD
from tensorflow.keras import regularizers
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense, Dropout, Activation, Flatten, BatchNormalization
from tensorflow.keras.layers import Conv2D, MaxPooling2D, AveragePooling2D
from tensorflow.keras import losses

print(tf.__version__)    #YOUR TF VERSION CHECK
```

    2.9.0



```python
#Train data has folders for each class but Validation has just one folder.
#This section of the code iterates over the Val_annots file, creates folders by the name of the class of the image and saves the images in their respective folders. Finally we delete the cumulated images folder.

df = pd.read_csv('tiny-imagenet-200/val/Val_annots.csv')

parent_dir = 'tiny-imagenet-200/val/'
for i in range(len(df)):
    image_path = os.path.join(parent_dir, df.loc[i]['Name'])
    if not os.path.exists(parent_dir + df.loc[i]['Name']):
        os.mkdir(image_path)
    shutil.copy(parent_dir + 'images/' + df.loc[i]['Image'], image_path)
    
shutil.rmtree(parent_dir + 'images)
```

#### The Tiny ImageNet Dataset can be downloaded from https://image-net.org/download-images.php


```python
# Define the image size and number of classes
img_size = 64
num_classes = 200

# Create the data generators for training and validation sets
train_datagen = ImageDataGenerator(
    rescale=1./255,
    horizontal_flip=True,
)

train_generator = train_datagen.flow_from_directory(
    'tiny-imagenet-200/train',
    target_size=(img_size, img_size),
    batch_size=64,
    class_mode='categorical'
)

val_datagen = ImageDataGenerator(
    rescale=1./255,
    horizontal_flip=True,
)

val_generator = val_datagen.flow_from_directory(
    'tiny-imagenet-200/val',
    target_size=(img_size, img_size),
    batch_size=64,
    class_mode='categorical'
)
```

    Found 100000 images belonging to 200 classes.
    Found 10000 images belonging to 200 classes.



```python
import numpy as np
from PIL import Image
import matplotlib.pyplot as plt

#Displaying a sample train image of Fish category
image = Image.open('tiny-imagenet-200/train/n01443537/images/n01443537_4.JPEG')
image_array = np.asarray(image)

plt.imshow(image_array)
plt.show()
```


    
![png](IE7615_Project_files/IE7615_Project_4_0.png)
    


#### As we can see the image is only of 64X64X3 size and is highly blured. Classification can be performed but expecting high validation accuracy can be challenging.


```python
#Below class is to record the model training times
class TimeHistory(tf.keras.callbacks.Callback):
    def on_train_begin(self, logs={}):
        self.times = []
        
    def on_epoch_begin(self, batch, logs={}):
        self.epoch_time_start = time.time()
        
    def on_epoch_end(self, batch, logs={}):
        epoch_time_end = time.time()
        self.times.append(epoch_time_end - self.epoch_time_start)
```

# DEEP CNN Models

## 1. Single Convolutional Layer NN model


```python
# Define the CNN architecture
model1 = tf.keras.Sequential([
    tf.keras.layers.Conv2D(32, (3, 3), activation='relu', input_shape=(img_size, img_size, 3)),
    tf.keras.layers.MaxPooling2D((2, 2)),
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(1024, activation='relu'),
    tf.keras.layers.Dense(num_classes, activation='softmax')
])
```


```python
print(model1.summary())
```

    Model: "sequential"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     conv2d (Conv2D)             (None, 62, 62, 32)        896       
                                                                     
     max_pooling2d (MaxPooling2D  (None, 31, 31, 32)       0         
     )                                                               
                                                                     
     flatten (Flatten)           (None, 30752)             0         
                                                                     
     dense (Dense)               (None, 1024)              31491072  
                                                                     
     dense_1 (Dense)             (None, 200)               205000    
                                                                     
    =================================================================
    Total params: 31,696,968
    Trainable params: 31,696,968
    Non-trainable params: 0
    _________________________________________________________________
    None



```python
time_callback = TimeHistory()

# Compile the model with an optimizer, a loss function, and evaluation metrics
model1.compile(optimizer=Adam(learning_rate = 0.0001),
              loss='categorical_crossentropy',
              metrics=['accuracy'])

# Train the model on the training data and validate it on the validation data
with tf.device('/device:GPU:0'):
    history = model1.fit(train_generator,
                        validation_data=val_generator,
                        epochs=15,
                        callbacks=[time_callback, tf.keras.callbacks.TensorBoard(log_dir='./logs')])
```

    Epoch 1/15
       6/1563 [..............................] - ETA: 36s - loss: 5.3947 - accuracy: 0.0104    WARNING:tensorflow:Callback method `on_train_batch_end` is slow compared to the batch time (batch time: 0.0093s vs `on_train_batch_end` time: 0.0169s). Check your callbacks.
    1563/1563 [==============================] - 38s 24ms/step - loss: 4.7895 - accuracy: 0.0600 - val_loss: 4.4842 - val_accuracy: 0.0993
    Epoch 2/15
    1563/1563 [==============================] - 36s 23ms/step - loss: 4.3215 - accuracy: 0.1191 - val_loss: 4.2536 - val_accuracy: 0.1265
    Epoch 3/15
    1563/1563 [==============================] - 36s 23ms/step - loss: 4.0804 - accuracy: 0.1529 - val_loss: 4.1041 - val_accuracy: 0.1457
    Epoch 4/15
    1563/1563 [==============================] - 36s 23ms/step - loss: 3.8904 - accuracy: 0.1814 - val_loss: 3.9833 - val_accuracy: 0.1618
    Epoch 5/15
    1563/1563 [==============================] - 36s 23ms/step - loss: 3.7341 - accuracy: 0.2067 - val_loss: 3.8976 - val_accuracy: 0.1720
    Epoch 6/15
    1563/1563 [==============================] - 36s 23ms/step - loss: 3.5990 - accuracy: 0.2288 - val_loss: 3.8270 - val_accuracy: 0.1868
    Epoch 7/15
    1563/1563 [==============================] - 36s 23ms/step - loss: 3.4708 - accuracy: 0.2517 - val_loss: 3.7874 - val_accuracy: 0.1942
    Epoch 8/15
    1563/1563 [==============================] - 37s 24ms/step - loss: 3.3522 - accuracy: 0.2710 - val_loss: 3.7486 - val_accuracy: 0.1979
    Epoch 9/15
    1563/1563 [==============================] - 37s 24ms/step - loss: 3.2396 - accuracy: 0.2926 - val_loss: 3.7062 - val_accuracy: 0.2034
    Epoch 10/15
    1563/1563 [==============================] - 37s 24ms/step - loss: 3.1341 - accuracy: 0.3120 - val_loss: 3.7092 - val_accuracy: 0.2050
    Epoch 11/15
    1563/1563 [==============================] - 38s 24ms/step - loss: 3.0311 - accuracy: 0.3301 - val_loss: 3.6921 - val_accuracy: 0.2084
    Epoch 12/15
    1563/1563 [==============================] - 37s 24ms/step - loss: 2.9279 - accuracy: 0.3504 - val_loss: 3.6742 - val_accuracy: 0.2143
    Epoch 13/15
    1563/1563 [==============================] - 37s 24ms/step - loss: 2.8303 - accuracy: 0.3698 - val_loss: 3.6729 - val_accuracy: 0.2114
    Epoch 14/15
    1563/1563 [==============================] - 37s 23ms/step - loss: 2.7354 - accuracy: 0.3883 - val_loss: 3.6693 - val_accuracy: 0.2207
    Epoch 15/15
    1563/1563 [==============================] - 36s 23ms/step - loss: 2.6385 - accuracy: 0.4084 - val_loss: 3.6795 - val_accuracy: 0.2143



```python
total_time = sum(time_callback.times)
print(f"Total execution time: {total_time:.2f} seconds")
```

    Total execution time: 552.10 seconds


## 2. Two Convolutional Layer NN model



```python
# Define the CNN architecture
model2 = tf.keras.Sequential([
    tf.keras.layers.Conv2D(32, (3, 3), activation='relu', input_shape=(img_size, img_size, 3)),
    tf.keras.layers.MaxPooling2D((2, 2)),
    tf.keras.layers.Conv2D(64, (3, 3), activation='relu', kernel_regularizer=regularizers.l2(0.01)),
    tf.keras.layers.MaxPooling2D((2, 2)),
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(1024, activation='relu'),
    tf.keras.layers.Dense(num_classes, activation='softmax')
])
```


```python
print(model2.summary())
```

    Model: "sequential_1"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     conv2d_1 (Conv2D)           (None, 62, 62, 32)        896       
                                                                     
     max_pooling2d_1 (MaxPooling  (None, 31, 31, 32)       0         
     2D)                                                             
                                                                     
     conv2d_2 (Conv2D)           (None, 29, 29, 64)        18496     
                                                                     
     max_pooling2d_2 (MaxPooling  (None, 14, 14, 64)       0         
     2D)                                                             
                                                                     
     flatten_1 (Flatten)         (None, 12544)             0         
                                                                     
     dense_2 (Dense)             (None, 1024)              12846080  
                                                                     
     dense_3 (Dense)             (None, 200)               205000    
                                                                     
    =================================================================
    Total params: 13,070,472
    Trainable params: 13,070,472
    Non-trainable params: 0
    _________________________________________________________________
    None



```python
time_callback = TimeHistory()

# Compile the model with an optimizer, a loss function, and evaluation metrics
model2.compile(optimizer=Adam(learning_rate=0.0001),
              loss='categorical_crossentropy',
              metrics=['accuracy'])

# Train the model on the training data and validate it on the validation data
with tf.device('/device:GPU:0'):
    history = model2.fit(train_generator,
                        validation_data=val_generator,
                        epochs=15,
                        callbacks=[time_callback, tf.keras.callbacks.TensorBoard(log_dir='./logs')])
```

    Epoch 1/15
       6/1563 [..............................] - ETA: 41s - loss: 5.7219 - accuracy: 0.0026   WARNING:tensorflow:Callback method `on_train_batch_end` is slow compared to the batch time (batch time: 0.0118s vs `on_train_batch_end` time: 0.0183s). Check your callbacks.
    1563/1563 [==============================] - 31s 20ms/step - loss: 4.9267 - accuracy: 0.0650 - val_loss: 4.5511 - val_accuracy: 0.1037
    Epoch 2/15
    1563/1563 [==============================] - 34s 22ms/step - loss: 4.3696 - accuracy: 0.1274 - val_loss: 4.2424 - val_accuracy: 0.1458
    Epoch 3/15
    1563/1563 [==============================] - 32s 21ms/step - loss: 4.0945 - accuracy: 0.1645 - val_loss: 4.0543 - val_accuracy: 0.1671
    Epoch 4/15
    1563/1563 [==============================] - 31s 20ms/step - loss: 3.8943 - accuracy: 0.1944 - val_loss: 3.9258 - val_accuracy: 0.1874
    Epoch 5/15
    1563/1563 [==============================] - 31s 20ms/step - loss: 3.7441 - accuracy: 0.2176 - val_loss: 3.8419 - val_accuracy: 0.1994
    Epoch 6/15
    1563/1563 [==============================] - 33s 21ms/step - loss: 3.6196 - accuracy: 0.2376 - val_loss: 3.7395 - val_accuracy: 0.2154
    Epoch 7/15
    1563/1563 [==============================] - 33s 21ms/step - loss: 3.5122 - accuracy: 0.2550 - val_loss: 3.6906 - val_accuracy: 0.2245
    Epoch 8/15
    1563/1563 [==============================] - 32s 20ms/step - loss: 3.4221 - accuracy: 0.2710 - val_loss: 3.6632 - val_accuracy: 0.2292
    Epoch 9/15
    1563/1563 [==============================] - 32s 20ms/step - loss: 3.3374 - accuracy: 0.2852 - val_loss: 3.6227 - val_accuracy: 0.2397
    Epoch 10/15
    1563/1563 [==============================] - 32s 20ms/step - loss: 3.2593 - accuracy: 0.2984 - val_loss: 3.6215 - val_accuracy: 0.2384
    Epoch 11/15
    1563/1563 [==============================] - 32s 20ms/step - loss: 3.1897 - accuracy: 0.3123 - val_loss: 3.5856 - val_accuracy: 0.2469
    Epoch 12/15
    1563/1563 [==============================] - 32s 20ms/step - loss: 3.1169 - accuracy: 0.3241 - val_loss: 3.5701 - val_accuracy: 0.2502
    Epoch 13/15
    1563/1563 [==============================] - 32s 20ms/step - loss: 3.0455 - accuracy: 0.3387 - val_loss: 3.5597 - val_accuracy: 0.2494
    Epoch 14/15
    1563/1563 [==============================] - 32s 20ms/step - loss: 2.9837 - accuracy: 0.3494 - val_loss: 3.5479 - val_accuracy: 0.2540
    Epoch 15/15
    1563/1563 [==============================] - 32s 20ms/step - loss: 2.9102 - accuracy: 0.3644 - val_loss: 3.5542 - val_accuracy: 0.2500



```python
total_time = sum(time_callback.times)
print(f"Total execution time: {total_time:.2f} seconds")
```

    Total execution time: 478.81 seconds


## 3. DEEP CNN Model 1


```python
model3 = Sequential()

model3.add(Conv2D(64, (3, 3), strides=(1,1), padding='same', input_shape=(img_size, img_size, 3)))
model3.add(BatchNormalization())
model3.add(Conv2D(64, (3, 3), strides=(1,1), padding='same', kernel_regularizer=regularizers.l2(0.01)))
model3.add(BatchNormalization())
model3.add(MaxPooling2D(pool_size=(3, 3), strides=(2, 2), padding='same'))
model3.add(Activation('relu'))

model3.add(Conv2D(128, (3, 3), strides=(1,1), padding='same', kernel_regularizer=regularizers.l2(0.01)))
model3.add(BatchNormalization())
model3.add(Conv2D(128, (3, 3), strides=(1,1), padding='same', kernel_regularizer=regularizers.l2(0.01)))
model3.add(BatchNormalization())
model3.add(MaxPooling2D(pool_size=(3, 3), strides=(2, 2), padding='same'))
model3.add(Activation('relu'))

model3.add(Conv2D(128, (3, 3), strides=(1,1), padding='same', kernel_regularizer=regularizers.l2(0.001)))
model3.add(BatchNormalization())
model3.add(Conv2D(128, (3, 3), strides=(1,1), padding='same', kernel_regularizer=regularizers.l2(0.001)))
model3.add(BatchNormalization())
model3.add(Activation('relu'))
model3.add(MaxPooling2D(pool_size=(3, 3), strides=(2, 2), padding='same'))

model3.add(Conv2D(128, (3, 3), strides=(1,1), padding='same', kernel_regularizer=regularizers.l2(0.001)))
model3.add(BatchNormalization())
model3.add(Conv2D(128, (3, 3), strides=(1,1), padding='same', kernel_regularizer=regularizers.l2(0.001)))
model3.add(BatchNormalization())
model3.add(Activation('relu'))
model3.add(MaxPooling2D(pool_size=(3, 3), strides=(2, 2), padding='same'))

model3.add(Conv2D(256, (3, 3), strides=(1,1), padding='same', kernel_regularizer=regularizers.l2(0.001)))
model3.add(BatchNormalization())
model3.add(Conv2D(512, (3, 3), strides=(1,1), padding='same', kernel_regularizer=regularizers.l2(0.001)))
model3.add(BatchNormalization())
model3.add(Activation('relu'))
model3.add(MaxPooling2D(pool_size=(3, 3), strides=(2, 2), padding='same'))

model3.add(Flatten())
model3.add(Dense(4096))
model3.add(BatchNormalization())
model3.add(Activation('relu'))

model3.add(Dense(1024))
model3.add(BatchNormalization())
model3.add(Activation('relu'))

model3.add(Dense(num_classes))

model3.add(Activation('softmax'))

time_callback = TimeHistory()

model3.compile(loss=losses.categorical_crossentropy, 
optimizer=Adam(learning_rate=0.0001), metrics=['accuracy'])
```


```python
print(model3.summary())
```

    Model: "sequential_2"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     conv2d_3 (Conv2D)           (None, 64, 64, 64)        1792      
                                                                     
     batch_normalization (BatchN  (None, 64, 64, 64)       256       
     ormalization)                                                   
                                                                     
     conv2d_4 (Conv2D)           (None, 64, 64, 64)        36928     
                                                                     
     batch_normalization_1 (Batc  (None, 64, 64, 64)       256       
     hNormalization)                                                 
                                                                     
     max_pooling2d_3 (MaxPooling  (None, 32, 32, 64)       0         
     2D)                                                             
                                                                     
     activation (Activation)     (None, 32, 32, 64)        0         
                                                                     
     conv2d_5 (Conv2D)           (None, 32, 32, 128)       73856     
                                                                     
     batch_normalization_2 (Batc  (None, 32, 32, 128)      512       
     hNormalization)                                                 
                                                                     
     conv2d_6 (Conv2D)           (None, 32, 32, 128)       147584    
                                                                     
     batch_normalization_3 (Batc  (None, 32, 32, 128)      512       
     hNormalization)                                                 
                                                                     
     max_pooling2d_4 (MaxPooling  (None, 16, 16, 128)      0         
     2D)                                                             
                                                                     
     activation_1 (Activation)   (None, 16, 16, 128)       0         
                                                                     
     conv2d_7 (Conv2D)           (None, 16, 16, 128)       147584    
                                                                     
     batch_normalization_4 (Batc  (None, 16, 16, 128)      512       
     hNormalization)                                                 
                                                                     
     conv2d_8 (Conv2D)           (None, 16, 16, 128)       147584    
                                                                     
     batch_normalization_5 (Batc  (None, 16, 16, 128)      512       
     hNormalization)                                                 
                                                                     
     activation_2 (Activation)   (None, 16, 16, 128)       0         
                                                                     
     max_pooling2d_5 (MaxPooling  (None, 8, 8, 128)        0         
     2D)                                                             
                                                                     
     conv2d_9 (Conv2D)           (None, 8, 8, 128)         147584    
                                                                     
     batch_normalization_6 (Batc  (None, 8, 8, 128)        512       
     hNormalization)                                                 
                                                                     
     conv2d_10 (Conv2D)          (None, 8, 8, 128)         147584    
                                                                     
     batch_normalization_7 (Batc  (None, 8, 8, 128)        512       
     hNormalization)                                                 
                                                                     
     activation_3 (Activation)   (None, 8, 8, 128)         0         
                                                                     
     max_pooling2d_6 (MaxPooling  (None, 4, 4, 128)        0         
     2D)                                                             
                                                                     
     conv2d_11 (Conv2D)          (None, 4, 4, 256)         295168    
                                                                     
     batch_normalization_8 (Batc  (None, 4, 4, 256)        1024      
     hNormalization)                                                 
                                                                     
     conv2d_12 (Conv2D)          (None, 4, 4, 512)         1180160   
                                                                     
     batch_normalization_9 (Batc  (None, 4, 4, 512)        2048      
     hNormalization)                                                 
                                                                     
     activation_4 (Activation)   (None, 4, 4, 512)         0         
                                                                     
     max_pooling2d_7 (MaxPooling  (None, 2, 2, 512)        0         
     2D)                                                             
                                                                     
     flatten_2 (Flatten)         (None, 2048)              0         
                                                                     
     dense_4 (Dense)             (None, 4096)              8392704   
                                                                     
     batch_normalization_10 (Bat  (None, 4096)             16384     
     chNormalization)                                                
                                                                     
     activation_5 (Activation)   (None, 4096)              0         
                                                                     
     dense_5 (Dense)             (None, 1024)              4195328   
                                                                     
     batch_normalization_11 (Bat  (None, 1024)             4096      
     chNormalization)                                                
                                                                     
     activation_6 (Activation)   (None, 1024)              0         
                                                                     
     dense_6 (Dense)             (None, 200)               205000    
                                                                     
     activation_7 (Activation)   (None, 200)               0         
                                                                     
    =================================================================
    Total params: 15,145,992
    Trainable params: 15,132,424
    Non-trainable params: 13,568
    _________________________________________________________________
    None



```python
# Train the model on the training data and validate it on the validation data
with tf.device('/device:GPU:0'):
    history = model3.fit(train_generator,
                        validation_data=val_generator,
                        epochs=15,
                        callbacks=[time_callback, tf.keras.callbacks.TensorBoard(log_dir='./logs')])
```

    Epoch 1/15
       6/1563 [..............................] - ETA: 3:42 - loss: 9.4461 - accuracy: 0.0052WARNING:tensorflow:Callback method `on_train_batch_end` is slow compared to the batch time (batch time: 0.0620s vs `on_train_batch_end` time: 0.1052s). Check your callbacks.
    1563/1563 [==============================] - 197s 125ms/step - loss: 7.1246 - accuracy: 0.1654 - val_loss: 6.1606 - val_accuracy: 0.2170
    Epoch 2/15
    1563/1563 [==============================] - 196s 125ms/step - loss: 5.3315 - accuracy: 0.2849 - val_loss: 4.9999 - val_accuracy: 0.2842
    Epoch 3/15
    1563/1563 [==============================] - 196s 125ms/step - loss: 4.3545 - accuracy: 0.3569 - val_loss: 4.3981 - val_accuracy: 0.3104
    Epoch 4/15
    1563/1563 [==============================] - 196s 125ms/step - loss: 3.7288 - accuracy: 0.4108 - val_loss: 4.1502 - val_accuracy: 0.3201
    Epoch 5/15
    1563/1563 [==============================] - 196s 125ms/step - loss: 3.2835 - accuracy: 0.4561 - val_loss: 3.6812 - val_accuracy: 0.3706
    Epoch 6/15
    1563/1563 [==============================] - 196s 125ms/step - loss: 2.9388 - accuracy: 0.4983 - val_loss: 3.4901 - val_accuracy: 0.3859
    Epoch 7/15
    1563/1563 [==============================] - 196s 125ms/step - loss: 2.6481 - accuracy: 0.5429 - val_loss: 3.3602 - val_accuracy: 0.4059
    Epoch 8/15
    1563/1563 [==============================] - 208s 133ms/step - loss: 2.3932 - accuracy: 0.5840 - val_loss: 3.3655 - val_accuracy: 0.3955
    Epoch 9/15
    1563/1563 [==============================] - 210s 135ms/step - loss: 2.1591 - accuracy: 0.6242 - val_loss: 3.3649 - val_accuracy: 0.3959
    Epoch 10/15
    1563/1563 [==============================] - 210s 135ms/step - loss: 1.9417 - accuracy: 0.6687 - val_loss: 3.3642 - val_accuracy: 0.3958
    Epoch 11/15
    1563/1563 [==============================] - 210s 135ms/step - loss: 1.7443 - accuracy: 0.7098 - val_loss: 3.3743 - val_accuracy: 0.3960
    Epoch 12/15
    1563/1563 [==============================] - 211s 135ms/step - loss: 1.5586 - accuracy: 0.7505 - val_loss: 3.3587 - val_accuracy: 0.4036
    Epoch 13/15
    1563/1563 [==============================] - 211s 135ms/step - loss: 1.4000 - accuracy: 0.7860 - val_loss: 3.5995 - val_accuracy: 0.3777
    Epoch 14/15
    1563/1563 [==============================] - 211s 135ms/step - loss: 1.2616 - accuracy: 0.8176 - val_loss: 3.4843 - val_accuracy: 0.3940
    Epoch 15/15
    1563/1563 [==============================] - 211s 135ms/step - loss: 1.1472 - accuracy: 0.8426 - val_loss: 3.5772 - val_accuracy: 0.3954



```python
total_time = sum(time_callback.times)
print(f"Total execution time: {total_time:.2f} seconds")
```

    Total execution time: 3054.00 seconds


## 4. Deep CNN Model 2


```python
# Import required libraries
import tensorflow as tf
from tensorflow.keras import layers

# Define the input shape
input_shape = (64, 64, 3)

# Define the model layers
model4 = tf.keras.Sequential([
    layers.Conv2D(64, (3,3), padding='same', activation='relu', input_shape=input_shape),
    layers.Conv2D(64, (3,3), padding='same', activation='relu', kernel_regularizer=regularizers.l2(0.01)),
    layers.MaxPooling2D((2,2)),
    layers.BatchNormalization(),

    layers.Conv2D(128, (3,3), padding='same', activation='relu', kernel_regularizer=regularizers.l2(0.01)),
    layers.MaxPooling2D((2,2)),
    layers.BatchNormalization(),

    layers.Conv2D(256, (3,3), padding='same', activation='relu', kernel_regularizer=regularizers.l2(0.01)),
    layers.Conv2D(256, (3,3), padding='same', activation='relu', kernel_regularizer=regularizers.l2(0.01)),
    layers.MaxPooling2D((2,2)),
    layers.Flatten(),

    layers.Dense(1024, activation='relu'),
    layers.Dropout(0.5), 
    layers.Dense(512, activation='relu'),
    layers.Dropout(0.5),
    layers.Dense(200, activation='softmax')
])

time_callback = TimeHistory()

# Compile the model
model4.compile(optimizer=Adam(learning_rate=0.0001),
              loss='categorical_crossentropy',
              metrics=['accuracy'])
```


```python
# Print the model summary
print(model4.summary())
```

    Model: "sequential_3"
    _________________________________________________________________
     Layer (type)                Output Shape              Param #   
    =================================================================
     conv2d_13 (Conv2D)          (None, 64, 64, 64)        1792      
                                                                     
     conv2d_14 (Conv2D)          (None, 64, 64, 64)        36928     
                                                                     
     max_pooling2d_8 (MaxPooling  (None, 32, 32, 64)       0         
     2D)                                                             
                                                                     
     batch_normalization_12 (Bat  (None, 32, 32, 64)       256       
     chNormalization)                                                
                                                                     
     conv2d_15 (Conv2D)          (None, 32, 32, 128)       73856     
                                                                     
     max_pooling2d_9 (MaxPooling  (None, 16, 16, 128)      0         
     2D)                                                             
                                                                     
     batch_normalization_13 (Bat  (None, 16, 16, 128)      512       
     chNormalization)                                                
                                                                     
     conv2d_16 (Conv2D)          (None, 16, 16, 256)       295168    
                                                                     
     conv2d_17 (Conv2D)          (None, 16, 16, 256)       590080    
                                                                     
     max_pooling2d_10 (MaxPoolin  (None, 8, 8, 256)        0         
     g2D)                                                            
                                                                     
     flatten_3 (Flatten)         (None, 16384)             0         
                                                                     
     dense_7 (Dense)             (None, 1024)              16778240  
                                                                     
     dropout (Dropout)           (None, 1024)              0         
                                                                     
     dense_8 (Dense)             (None, 512)               524800    
                                                                     
     dropout_1 (Dropout)         (None, 512)               0         
                                                                     
     dense_9 (Dense)             (None, 200)               102600    
                                                                     
    =================================================================
    Total params: 18,404,232
    Trainable params: 18,403,848
    Non-trainable params: 384
    _________________________________________________________________
    None



```python
# Train the model
with tf.device('/device:GPU:0'):
    history = model4.fit(train_generator,
                        epochs=25,
                        validation_data=val_generator,
                        callbacks=[time_callback, tf.keras.callbacks.TensorBoard(log_dir='./logs')])
```

    Epoch 1/25
       6/1563 [..............................] - ETA: 2:26 - loss: 11.5748 - accuracy: 0.0052  WARNING:tensorflow:Callback method `on_train_batch_end` is slow compared to the batch time (batch time: 0.0323s vs `on_train_batch_end` time: 0.0623s). Check your callbacks.
    1563/1563 [==============================] - 151s 96ms/step - loss: 7.1938 - accuracy: 0.0339 - val_loss: 5.0122 - val_accuracy: 0.1006
    Epoch 2/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 4.6325 - accuracy: 0.1095 - val_loss: 4.0970 - val_accuracy: 0.1766
    Epoch 3/25
    1563/1563 [==============================] - 149s 96ms/step - loss: 4.0229 - accuracy: 0.1744 - val_loss: 3.6336 - val_accuracy: 0.2409
    Epoch 4/25
    1563/1563 [==============================] - 149s 96ms/step - loss: 3.6961 - accuracy: 0.2189 - val_loss: 3.4759 - val_accuracy: 0.2642
    Epoch 5/25
    1563/1563 [==============================] - 149s 96ms/step - loss: 3.4683 - accuracy: 0.2555 - val_loss: 3.2908 - val_accuracy: 0.2893
    Epoch 6/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 3.2929 - accuracy: 0.2885 - val_loss: 3.1674 - val_accuracy: 0.3149
    Epoch 7/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 3.1501 - accuracy: 0.3148 - val_loss: 3.0611 - val_accuracy: 0.3317
    Epoch 8/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 3.0179 - accuracy: 0.3410 - val_loss: 2.9928 - val_accuracy: 0.3503
    Epoch 9/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.9114 - accuracy: 0.3603 - val_loss: 2.9234 - val_accuracy: 0.3588
    Epoch 10/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.8053 - accuracy: 0.3821 - val_loss: 2.8927 - val_accuracy: 0.3678
    Epoch 11/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.7158 - accuracy: 0.3999 - val_loss: 2.8264 - val_accuracy: 0.3791
    Epoch 12/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.6325 - accuracy: 0.4184 - val_loss: 2.7976 - val_accuracy: 0.3892
    Epoch 13/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.5517 - accuracy: 0.4352 - val_loss: 2.7569 - val_accuracy: 0.4004
    Epoch 14/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.4762 - accuracy: 0.4508 - val_loss: 2.8391 - val_accuracy: 0.3837
    Epoch 15/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.3996 - accuracy: 0.4689 - val_loss: 2.7409 - val_accuracy: 0.3989
    Epoch 16/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.3301 - accuracy: 0.4836 - val_loss: 2.7665 - val_accuracy: 0.4049
    Epoch 17/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.2676 - accuracy: 0.4976 - val_loss: 2.7119 - val_accuracy: 0.4177
    Epoch 18/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.1972 - accuracy: 0.5127 - val_loss: 2.6823 - val_accuracy: 0.4169
    Epoch 19/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.1422 - accuracy: 0.5253 - val_loss: 2.7598 - val_accuracy: 0.4093
    Epoch 20/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.0679 - accuracy: 0.5410 - val_loss: 2.7221 - val_accuracy: 0.4182
    Epoch 21/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 2.0096 - accuracy: 0.5550 - val_loss: 2.8340 - val_accuracy: 0.3975
    Epoch 22/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 1.9539 - accuracy: 0.5672 - val_loss: 2.8361 - val_accuracy: 0.4000
    Epoch 23/25
    1563/1563 [==============================] - 149s 95ms/step - loss: 1.8948 - accuracy: 0.5814 - val_loss: 2.7627 - val_accuracy: 0.4200
    Epoch 24/25
    1563/1563 [==============================] - 149s 95ms/step - loss: 1.8422 - accuracy: 0.5928 - val_loss: 2.7544 - val_accuracy: 0.4185
    Epoch 25/25
    1563/1563 [==============================] - 150s 96ms/step - loss: 1.7789 - accuracy: 0.6089 - val_loss: 2.7473 - val_accuracy: 0.4240



```python
total_time = sum(time_callback.times)
print(f"Total execution time: {total_time:.2f} seconds")
```

    Total execution time: 3744.04 seconds


## 5) ResNet Model 1- ResNet50 


```python
resnet50_model = tf.keras.applications.ResNet50(
    weights='imagenet', 
    include_top=False, 
    input_shape=(img_size, img_size, 3)
)
```


```python
x = resnet50_model.output
x = layers.GlobalAveragePooling2D()(x)
x = layers.Dense(1024, activation='relu')(x)
x = layers.Dropout(0.5)(x)
predictions = layers.Dense(num_classes, activation='softmax')(x)

model5 = models.Model(inputs = resnet50_model.input, outputs=predictions)
```


```python
time_callback = TimeHistory()

# Compile the model
model5.compile(optimizer=Adam(learning_rate=0.0001),
              loss='categorical_crossentropy',
              metrics=['accuracy'])
```


```python
print(model5.summary())
```

    Model: "model"
    __________________________________________________________________________________________________
     Layer (type)                   Output Shape         Param #     Connected to                     
    ==================================================================================================
     input_1 (InputLayer)           [(None, 64, 64, 3)]  0           []                               
                                                                                                      
     conv1_pad (ZeroPadding2D)      (None, 70, 70, 3)    0           ['input_1[0][0]']                
                                                                                                      
     conv1_conv (Conv2D)            (None, 32, 32, 64)   9472        ['conv1_pad[0][0]']              
                                                                                                      
     conv1_bn (BatchNormalization)  (None, 32, 32, 64)   256         ['conv1_conv[0][0]']             
                                                                                                      
     conv1_relu (Activation)        (None, 32, 32, 64)   0           ['conv1_bn[0][0]']               
                                                                                                      
     pool1_pad (ZeroPadding2D)      (None, 34, 34, 64)   0           ['conv1_relu[0][0]']             
                                                                                                      
     pool1_pool (MaxPooling2D)      (None, 16, 16, 64)   0           ['pool1_pad[0][0]']              
                                                                                                      
     conv2_block1_1_conv (Conv2D)   (None, 16, 16, 64)   4160        ['pool1_pool[0][0]']             
                                                                                                      
     conv2_block1_1_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block1_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block1_1_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block1_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block1_2_conv (Conv2D)   (None, 16, 16, 64)   36928       ['conv2_block1_1_relu[0][0]']    
                                                                                                      
     conv2_block1_2_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block1_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block1_2_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block1_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block1_0_conv (Conv2D)   (None, 16, 16, 256)  16640       ['pool1_pool[0][0]']             
                                                                                                      
     conv2_block1_3_conv (Conv2D)   (None, 16, 16, 256)  16640       ['conv2_block1_2_relu[0][0]']    
                                                                                                      
     conv2_block1_0_bn (BatchNormal  (None, 16, 16, 256)  1024       ['conv2_block1_0_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block1_3_bn (BatchNormal  (None, 16, 16, 256)  1024       ['conv2_block1_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block1_add (Add)         (None, 16, 16, 256)  0           ['conv2_block1_0_bn[0][0]',      
                                                                      'conv2_block1_3_bn[0][0]']      
                                                                                                      
     conv2_block1_out (Activation)  (None, 16, 16, 256)  0           ['conv2_block1_add[0][0]']       
                                                                                                      
     conv2_block2_1_conv (Conv2D)   (None, 16, 16, 64)   16448       ['conv2_block1_out[0][0]']       
                                                                                                      
     conv2_block2_1_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block2_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block2_1_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block2_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block2_2_conv (Conv2D)   (None, 16, 16, 64)   36928       ['conv2_block2_1_relu[0][0]']    
                                                                                                      
     conv2_block2_2_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block2_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block2_2_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block2_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block2_3_conv (Conv2D)   (None, 16, 16, 256)  16640       ['conv2_block2_2_relu[0][0]']    
                                                                                                      
     conv2_block2_3_bn (BatchNormal  (None, 16, 16, 256)  1024       ['conv2_block2_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block2_add (Add)         (None, 16, 16, 256)  0           ['conv2_block1_out[0][0]',       
                                                                      'conv2_block2_3_bn[0][0]']      
                                                                                                      
     conv2_block2_out (Activation)  (None, 16, 16, 256)  0           ['conv2_block2_add[0][0]']       
                                                                                                      
     conv2_block3_1_conv (Conv2D)   (None, 16, 16, 64)   16448       ['conv2_block2_out[0][0]']       
                                                                                                      
     conv2_block3_1_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block3_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block3_1_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block3_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block3_2_conv (Conv2D)   (None, 16, 16, 64)   36928       ['conv2_block3_1_relu[0][0]']    
                                                                                                      
     conv2_block3_2_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block3_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block3_2_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block3_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block3_3_conv (Conv2D)   (None, 16, 16, 256)  16640       ['conv2_block3_2_relu[0][0]']    
                                                                                                      
     conv2_block3_3_bn (BatchNormal  (None, 16, 16, 256)  1024       ['conv2_block3_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block3_add (Add)         (None, 16, 16, 256)  0           ['conv2_block2_out[0][0]',       
                                                                      'conv2_block3_3_bn[0][0]']      
                                                                                                      
     conv2_block3_out (Activation)  (None, 16, 16, 256)  0           ['conv2_block3_add[0][0]']       
                                                                                                      
     conv3_block1_1_conv (Conv2D)   (None, 8, 8, 128)    32896       ['conv2_block3_out[0][0]']       
                                                                                                      
     conv3_block1_1_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block1_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block1_1_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block1_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block1_2_conv (Conv2D)   (None, 8, 8, 128)    147584      ['conv3_block1_1_relu[0][0]']    
                                                                                                      
     conv3_block1_2_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block1_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block1_2_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block1_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block1_0_conv (Conv2D)   (None, 8, 8, 512)    131584      ['conv2_block3_out[0][0]']       
                                                                                                      
     conv3_block1_3_conv (Conv2D)   (None, 8, 8, 512)    66048       ['conv3_block1_2_relu[0][0]']    
                                                                                                      
     conv3_block1_0_bn (BatchNormal  (None, 8, 8, 512)   2048        ['conv3_block1_0_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block1_3_bn (BatchNormal  (None, 8, 8, 512)   2048        ['conv3_block1_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block1_add (Add)         (None, 8, 8, 512)    0           ['conv3_block1_0_bn[0][0]',      
                                                                      'conv3_block1_3_bn[0][0]']      
                                                                                                      
     conv3_block1_out (Activation)  (None, 8, 8, 512)    0           ['conv3_block1_add[0][0]']       
                                                                                                      
     conv3_block2_1_conv (Conv2D)   (None, 8, 8, 128)    65664       ['conv3_block1_out[0][0]']       
                                                                                                      
     conv3_block2_1_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block2_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block2_1_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block2_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block2_2_conv (Conv2D)   (None, 8, 8, 128)    147584      ['conv3_block2_1_relu[0][0]']    
                                                                                                      
     conv3_block2_2_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block2_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block2_2_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block2_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block2_3_conv (Conv2D)   (None, 8, 8, 512)    66048       ['conv3_block2_2_relu[0][0]']    
                                                                                                      
     conv3_block2_3_bn (BatchNormal  (None, 8, 8, 512)   2048        ['conv3_block2_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block2_add (Add)         (None, 8, 8, 512)    0           ['conv3_block1_out[0][0]',       
                                                                      'conv3_block2_3_bn[0][0]']      
                                                                                                      
     conv3_block2_out (Activation)  (None, 8, 8, 512)    0           ['conv3_block2_add[0][0]']       
                                                                                                      
     conv3_block3_1_conv (Conv2D)   (None, 8, 8, 128)    65664       ['conv3_block2_out[0][0]']       
                                                                                                      
     conv3_block3_1_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block3_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block3_1_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block3_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block3_2_conv (Conv2D)   (None, 8, 8, 128)    147584      ['conv3_block3_1_relu[0][0]']    
                                                                                                      
     conv3_block3_2_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block3_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block3_2_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block3_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block3_3_conv (Conv2D)   (None, 8, 8, 512)    66048       ['conv3_block3_2_relu[0][0]']    
                                                                                                      
     conv3_block3_3_bn (BatchNormal  (None, 8, 8, 512)   2048        ['conv3_block3_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block3_add (Add)         (None, 8, 8, 512)    0           ['conv3_block2_out[0][0]',       
                                                                      'conv3_block3_3_bn[0][0]']      
                                                                                                      
     conv3_block3_out (Activation)  (None, 8, 8, 512)    0           ['conv3_block3_add[0][0]']       
                                                                                                      
     conv3_block4_1_conv (Conv2D)   (None, 8, 8, 128)    65664       ['conv3_block3_out[0][0]']       
                                                                                                      
     conv3_block4_1_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block4_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block4_1_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block4_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block4_2_conv (Conv2D)   (None, 8, 8, 128)    147584      ['conv3_block4_1_relu[0][0]']    
                                                                                                      
     conv3_block4_2_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block4_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block4_2_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block4_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block4_3_conv (Conv2D)   (None, 8, 8, 512)    66048       ['conv3_block4_2_relu[0][0]']    
                                                                                                      
     conv3_block4_3_bn (BatchNormal  (None, 8, 8, 512)   2048        ['conv3_block4_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block4_add (Add)         (None, 8, 8, 512)    0           ['conv3_block3_out[0][0]',       
                                                                      'conv3_block4_3_bn[0][0]']      
                                                                                                      
     conv3_block4_out (Activation)  (None, 8, 8, 512)    0           ['conv3_block4_add[0][0]']       
                                                                                                      
     conv4_block1_1_conv (Conv2D)   (None, 4, 4, 256)    131328      ['conv3_block4_out[0][0]']       
                                                                                                      
     conv4_block1_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block1_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block1_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block1_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block1_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block1_1_relu[0][0]']    
                                                                                                      
     conv4_block1_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block1_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block1_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block1_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block1_0_conv (Conv2D)   (None, 4, 4, 1024)   525312      ['conv3_block4_out[0][0]']       
                                                                                                      
     conv4_block1_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block1_2_relu[0][0]']    
                                                                                                      
     conv4_block1_0_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block1_0_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block1_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block1_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block1_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block1_0_bn[0][0]',      
                                                                      'conv4_block1_3_bn[0][0]']      
                                                                                                      
     conv4_block1_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block1_add[0][0]']       
                                                                                                      
     conv4_block2_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block1_out[0][0]']       
                                                                                                      
     conv4_block2_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block2_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block2_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block2_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block2_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block2_1_relu[0][0]']    
                                                                                                      
     conv4_block2_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block2_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block2_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block2_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block2_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block2_2_relu[0][0]']    
                                                                                                      
     conv4_block2_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block2_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block2_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block1_out[0][0]',       
                                                                      'conv4_block2_3_bn[0][0]']      
                                                                                                      
     conv4_block2_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block2_add[0][0]']       
                                                                                                      
     conv4_block3_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block2_out[0][0]']       
                                                                                                      
     conv4_block3_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block3_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block3_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block3_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block3_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block3_1_relu[0][0]']    
                                                                                                      
     conv4_block3_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block3_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block3_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block3_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block3_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block3_2_relu[0][0]']    
                                                                                                      
     conv4_block3_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block3_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block3_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block2_out[0][0]',       
                                                                      'conv4_block3_3_bn[0][0]']      
                                                                                                      
     conv4_block3_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block3_add[0][0]']       
                                                                                                      
     conv4_block4_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block3_out[0][0]']       
                                                                                                      
     conv4_block4_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block4_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block4_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block4_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block4_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block4_1_relu[0][0]']    
                                                                                                      
     conv4_block4_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block4_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block4_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block4_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block4_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block4_2_relu[0][0]']    
                                                                                                      
     conv4_block4_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block4_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block4_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block3_out[0][0]',       
                                                                      'conv4_block4_3_bn[0][0]']      
                                                                                                      
     conv4_block4_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block4_add[0][0]']       
                                                                                                      
     conv4_block5_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block4_out[0][0]']       
                                                                                                      
     conv4_block5_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block5_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block5_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block5_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block5_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block5_1_relu[0][0]']    
                                                                                                      
     conv4_block5_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block5_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block5_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block5_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block5_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block5_2_relu[0][0]']    
                                                                                                      
     conv4_block5_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block5_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block5_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block4_out[0][0]',       
                                                                      'conv4_block5_3_bn[0][0]']      
                                                                                                      
     conv4_block5_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block5_add[0][0]']       
                                                                                                      
     conv4_block6_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block5_out[0][0]']       
                                                                                                      
     conv4_block6_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block6_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block6_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block6_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block6_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block6_1_relu[0][0]']    
                                                                                                      
     conv4_block6_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block6_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block6_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block6_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block6_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block6_2_relu[0][0]']    
                                                                                                      
     conv4_block6_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block6_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block6_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block5_out[0][0]',       
                                                                      'conv4_block6_3_bn[0][0]']      
                                                                                                      
     conv4_block6_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block6_add[0][0]']       
                                                                                                      
     conv5_block1_1_conv (Conv2D)   (None, 2, 2, 512)    524800      ['conv4_block6_out[0][0]']       
                                                                                                      
     conv5_block1_1_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block1_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block1_1_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block1_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block1_2_conv (Conv2D)   (None, 2, 2, 512)    2359808     ['conv5_block1_1_relu[0][0]']    
                                                                                                      
     conv5_block1_2_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block1_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block1_2_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block1_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block1_0_conv (Conv2D)   (None, 2, 2, 2048)   2099200     ['conv4_block6_out[0][0]']       
                                                                                                      
     conv5_block1_3_conv (Conv2D)   (None, 2, 2, 2048)   1050624     ['conv5_block1_2_relu[0][0]']    
                                                                                                      
     conv5_block1_0_bn (BatchNormal  (None, 2, 2, 2048)  8192        ['conv5_block1_0_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block1_3_bn (BatchNormal  (None, 2, 2, 2048)  8192        ['conv5_block1_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block1_add (Add)         (None, 2, 2, 2048)   0           ['conv5_block1_0_bn[0][0]',      
                                                                      'conv5_block1_3_bn[0][0]']      
                                                                                                      
     conv5_block1_out (Activation)  (None, 2, 2, 2048)   0           ['conv5_block1_add[0][0]']       
                                                                                                      
     conv5_block2_1_conv (Conv2D)   (None, 2, 2, 512)    1049088     ['conv5_block1_out[0][0]']       
                                                                                                      
     conv5_block2_1_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block2_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block2_1_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block2_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block2_2_conv (Conv2D)   (None, 2, 2, 512)    2359808     ['conv5_block2_1_relu[0][0]']    
                                                                                                      
     conv5_block2_2_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block2_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block2_2_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block2_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block2_3_conv (Conv2D)   (None, 2, 2, 2048)   1050624     ['conv5_block2_2_relu[0][0]']    
                                                                                                      
     conv5_block2_3_bn (BatchNormal  (None, 2, 2, 2048)  8192        ['conv5_block2_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block2_add (Add)         (None, 2, 2, 2048)   0           ['conv5_block1_out[0][0]',       
                                                                      'conv5_block2_3_bn[0][0]']      
                                                                                                      
     conv5_block2_out (Activation)  (None, 2, 2, 2048)   0           ['conv5_block2_add[0][0]']       
                                                                                                      
     conv5_block3_1_conv (Conv2D)   (None, 2, 2, 512)    1049088     ['conv5_block2_out[0][0]']       
                                                                                                      
     conv5_block3_1_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block3_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block3_1_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block3_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block3_2_conv (Conv2D)   (None, 2, 2, 512)    2359808     ['conv5_block3_1_relu[0][0]']    
                                                                                                      
     conv5_block3_2_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block3_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block3_2_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block3_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block3_3_conv (Conv2D)   (None, 2, 2, 2048)   1050624     ['conv5_block3_2_relu[0][0]']    
                                                                                                      
     conv5_block3_3_bn (BatchNormal  (None, 2, 2, 2048)  8192        ['conv5_block3_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block3_add (Add)         (None, 2, 2, 2048)   0           ['conv5_block2_out[0][0]',       
                                                                      'conv5_block3_3_bn[0][0]']      
                                                                                                      
     conv5_block3_out (Activation)  (None, 2, 2, 2048)   0           ['conv5_block3_add[0][0]']       
                                                                                                      
     global_average_pooling2d (Glob  (None, 2048)        0           ['conv5_block3_out[0][0]']       
     alAveragePooling2D)                                                                              
                                                                                                      
     dense (Dense)                  (None, 1024)         2098176     ['global_average_pooling2d[0][0]'
                                                                     ]                                
                                                                                                      
     dropout (Dropout)              (None, 1024)         0           ['dense[0][0]']                  
                                                                                                      
     dense_1 (Dense)                (None, 200)          205000      ['dropout[0][0]']                
                                                                                                      
    ==================================================================================================
    Total params: 25,890,888
    Trainable params: 25,837,768
    Non-trainable params: 53,120
    __________________________________________________________________________________________________
    None



```python
# Train the model
with tf.device('/device:GPU:0'):
    history = model5.fit(train_generator,
                        epochs=15,
                        validation_data=val_generator,
                        callbacks=[time_callback, tf.keras.callbacks.TensorBoard(log_dir='./logs')])
```

    Epoch 1/15
       6/1563 [..............................] - ETA: 3:31 - loss: 6.8956 - accuracy: 0.0000e+00WARNING:tensorflow:Callback method `on_train_batch_end` is slow compared to the batch time (batch time: 0.0998s vs `on_train_batch_end` time: 0.1228s). Check your callbacks.
    1563/1563 [==============================] - 228s 143ms/step - loss: 3.4713 - accuracy: 0.2689 - val_loss: 2.3051 - val_accuracy: 0.4529
    Epoch 2/15
    1563/1563 [==============================] - 222s 142ms/step - loss: 2.1666 - accuracy: 0.4841 - val_loss: 2.0099 - val_accuracy: 0.5088
    Epoch 3/15
    1563/1563 [==============================] - 221s 141ms/step - loss: 1.7259 - accuracy: 0.5727 - val_loss: 1.9419 - val_accuracy: 0.5334
    Epoch 4/15
    1563/1563 [==============================] - 219s 140ms/step - loss: 1.4161 - accuracy: 0.6404 - val_loss: 1.9479 - val_accuracy: 0.5355
    Epoch 5/15
    1563/1563 [==============================] - 220s 140ms/step - loss: 1.1795 - accuracy: 0.6917 - val_loss: 1.8960 - val_accuracy: 0.5548
    Epoch 6/15
    1563/1563 [==============================] - 220s 141ms/step - loss: 0.9778 - accuracy: 0.7399 - val_loss: 1.9514 - val_accuracy: 0.5486
    Epoch 7/15
    1563/1563 [==============================] - 220s 141ms/step - loss: 0.8171 - accuracy: 0.7795 - val_loss: 2.0127 - val_accuracy: 0.5491
    Epoch 8/15
    1563/1563 [==============================] - 221s 142ms/step - loss: 0.6878 - accuracy: 0.8100 - val_loss: 2.0410 - val_accuracy: 0.5512
    Epoch 9/15
    1563/1563 [==============================] - 221s 142ms/step - loss: 0.5861 - accuracy: 0.8357 - val_loss: 2.1752 - val_accuracy: 0.5480
    Epoch 10/15
    1563/1563 [==============================] - 222s 142ms/step - loss: 0.5017 - accuracy: 0.8576 - val_loss: 2.2624 - val_accuracy: 0.5412
    Epoch 11/15
    1563/1563 [==============================] - 221s 141ms/step - loss: 0.4399 - accuracy: 0.8738 - val_loss: 2.2292 - val_accuracy: 0.5575
    Epoch 12/15
    1563/1563 [==============================] - 221s 141ms/step - loss: 0.3821 - accuracy: 0.8886 - val_loss: 2.2521 - val_accuracy: 0.5526
    Epoch 13/15
    1563/1563 [==============================] - 221s 141ms/step - loss: 0.3424 - accuracy: 0.8990 - val_loss: 2.3511 - val_accuracy: 0.5531
    Epoch 14/15
    1563/1563 [==============================] - 222s 142ms/step - loss: 0.3040 - accuracy: 0.9095 - val_loss: 2.4762 - val_accuracy: 0.5334
    Epoch 15/15
    1563/1563 [==============================] - 222s 142ms/step - loss: 0.2901 - accuracy: 0.9126 - val_loss: 2.4808 - val_accuracy: 0.5395



```python
total_time = sum(time_callback.times)
print(f"Total execution time: {total_time:.2f} seconds")
```

    Total execution time: 3320.05 seconds


## 6) ResNet Model 2 - ResNet101


```python
resnet101_model = tf.keras.applications.ResNet101(
    include_top=False,
    weights="imagenet",
    input_shape=(img_size, img_size, 3),
)
```


```python
x = resnet101_model.output
x = layers.GlobalAveragePooling2D()(x)
x = layers.Dense(1024, activation='relu')(x)
x = layers.Dropout(0.5)(x)
predictions = layers.Dense(num_classes, activation='softmax')(x)

model6 = models.Model(inputs = resnet101_model.input, outputs=predictions)
```


```python
time_callback = TimeHistory()

# Compile the model
model6.compile(optimizer=Adam(learning_rate=0.0001),
              loss='categorical_crossentropy',
              metrics=['accuracy'])
```


```python
print(model6.summary())
```

    Model: "model_1"
    __________________________________________________________________________________________________
     Layer (type)                   Output Shape         Param #     Connected to                     
    ==================================================================================================
     input_2 (InputLayer)           [(None, 64, 64, 3)]  0           []                               
                                                                                                      
     conv1_pad (ZeroPadding2D)      (None, 70, 70, 3)    0           ['input_2[0][0]']                
                                                                                                      
     conv1_conv (Conv2D)            (None, 32, 32, 64)   9472        ['conv1_pad[0][0]']              
                                                                                                      
     conv1_bn (BatchNormalization)  (None, 32, 32, 64)   256         ['conv1_conv[0][0]']             
                                                                                                      
     conv1_relu (Activation)        (None, 32, 32, 64)   0           ['conv1_bn[0][0]']               
                                                                                                      
     pool1_pad (ZeroPadding2D)      (None, 34, 34, 64)   0           ['conv1_relu[0][0]']             
                                                                                                      
     pool1_pool (MaxPooling2D)      (None, 16, 16, 64)   0           ['pool1_pad[0][0]']              
                                                                                                      
     conv2_block1_1_conv (Conv2D)   (None, 16, 16, 64)   4160        ['pool1_pool[0][0]']             
                                                                                                      
     conv2_block1_1_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block1_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block1_1_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block1_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block1_2_conv (Conv2D)   (None, 16, 16, 64)   36928       ['conv2_block1_1_relu[0][0]']    
                                                                                                      
     conv2_block1_2_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block1_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block1_2_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block1_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block1_0_conv (Conv2D)   (None, 16, 16, 256)  16640       ['pool1_pool[0][0]']             
                                                                                                      
     conv2_block1_3_conv (Conv2D)   (None, 16, 16, 256)  16640       ['conv2_block1_2_relu[0][0]']    
                                                                                                      
     conv2_block1_0_bn (BatchNormal  (None, 16, 16, 256)  1024       ['conv2_block1_0_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block1_3_bn (BatchNormal  (None, 16, 16, 256)  1024       ['conv2_block1_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block1_add (Add)         (None, 16, 16, 256)  0           ['conv2_block1_0_bn[0][0]',      
                                                                      'conv2_block1_3_bn[0][0]']      
                                                                                                      
     conv2_block1_out (Activation)  (None, 16, 16, 256)  0           ['conv2_block1_add[0][0]']       
                                                                                                      
     conv2_block2_1_conv (Conv2D)   (None, 16, 16, 64)   16448       ['conv2_block1_out[0][0]']       
                                                                                                      
     conv2_block2_1_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block2_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block2_1_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block2_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block2_2_conv (Conv2D)   (None, 16, 16, 64)   36928       ['conv2_block2_1_relu[0][0]']    
                                                                                                      
     conv2_block2_2_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block2_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block2_2_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block2_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block2_3_conv (Conv2D)   (None, 16, 16, 256)  16640       ['conv2_block2_2_relu[0][0]']    
                                                                                                      
     conv2_block2_3_bn (BatchNormal  (None, 16, 16, 256)  1024       ['conv2_block2_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block2_add (Add)         (None, 16, 16, 256)  0           ['conv2_block1_out[0][0]',       
                                                                      'conv2_block2_3_bn[0][0]']      
                                                                                                      
     conv2_block2_out (Activation)  (None, 16, 16, 256)  0           ['conv2_block2_add[0][0]']       
                                                                                                      
     conv2_block3_1_conv (Conv2D)   (None, 16, 16, 64)   16448       ['conv2_block2_out[0][0]']       
                                                                                                      
     conv2_block3_1_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block3_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block3_1_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block3_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block3_2_conv (Conv2D)   (None, 16, 16, 64)   36928       ['conv2_block3_1_relu[0][0]']    
                                                                                                      
     conv2_block3_2_bn (BatchNormal  (None, 16, 16, 64)  256         ['conv2_block3_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block3_2_relu (Activatio  (None, 16, 16, 64)  0           ['conv2_block3_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv2_block3_3_conv (Conv2D)   (None, 16, 16, 256)  16640       ['conv2_block3_2_relu[0][0]']    
                                                                                                      
     conv2_block3_3_bn (BatchNormal  (None, 16, 16, 256)  1024       ['conv2_block3_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv2_block3_add (Add)         (None, 16, 16, 256)  0           ['conv2_block2_out[0][0]',       
                                                                      'conv2_block3_3_bn[0][0]']      
                                                                                                      
     conv2_block3_out (Activation)  (None, 16, 16, 256)  0           ['conv2_block3_add[0][0]']       
                                                                                                      
     conv3_block1_1_conv (Conv2D)   (None, 8, 8, 128)    32896       ['conv2_block3_out[0][0]']       
                                                                                                      
     conv3_block1_1_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block1_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block1_1_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block1_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block1_2_conv (Conv2D)   (None, 8, 8, 128)    147584      ['conv3_block1_1_relu[0][0]']    
                                                                                                      
     conv3_block1_2_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block1_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block1_2_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block1_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block1_0_conv (Conv2D)   (None, 8, 8, 512)    131584      ['conv2_block3_out[0][0]']       
                                                                                                      
     conv3_block1_3_conv (Conv2D)   (None, 8, 8, 512)    66048       ['conv3_block1_2_relu[0][0]']    
                                                                                                      
     conv3_block1_0_bn (BatchNormal  (None, 8, 8, 512)   2048        ['conv3_block1_0_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block1_3_bn (BatchNormal  (None, 8, 8, 512)   2048        ['conv3_block1_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block1_add (Add)         (None, 8, 8, 512)    0           ['conv3_block1_0_bn[0][0]',      
                                                                      'conv3_block1_3_bn[0][0]']      
                                                                                                      
     conv3_block1_out (Activation)  (None, 8, 8, 512)    0           ['conv3_block1_add[0][0]']       
                                                                                                      
     conv3_block2_1_conv (Conv2D)   (None, 8, 8, 128)    65664       ['conv3_block1_out[0][0]']       
                                                                                                      
     conv3_block2_1_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block2_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block2_1_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block2_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block2_2_conv (Conv2D)   (None, 8, 8, 128)    147584      ['conv3_block2_1_relu[0][0]']    
                                                                                                      
     conv3_block2_2_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block2_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block2_2_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block2_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block2_3_conv (Conv2D)   (None, 8, 8, 512)    66048       ['conv3_block2_2_relu[0][0]']    
                                                                                                      
     conv3_block2_3_bn (BatchNormal  (None, 8, 8, 512)   2048        ['conv3_block2_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block2_add (Add)         (None, 8, 8, 512)    0           ['conv3_block1_out[0][0]',       
                                                                      'conv3_block2_3_bn[0][0]']      
                                                                                                      
     conv3_block2_out (Activation)  (None, 8, 8, 512)    0           ['conv3_block2_add[0][0]']       
                                                                                                      
     conv3_block3_1_conv (Conv2D)   (None, 8, 8, 128)    65664       ['conv3_block2_out[0][0]']       
                                                                                                      
     conv3_block3_1_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block3_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block3_1_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block3_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block3_2_conv (Conv2D)   (None, 8, 8, 128)    147584      ['conv3_block3_1_relu[0][0]']    
                                                                                                      
     conv3_block3_2_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block3_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block3_2_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block3_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block3_3_conv (Conv2D)   (None, 8, 8, 512)    66048       ['conv3_block3_2_relu[0][0]']    
                                                                                                      
     conv3_block3_3_bn (BatchNormal  (None, 8, 8, 512)   2048        ['conv3_block3_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block3_add (Add)         (None, 8, 8, 512)    0           ['conv3_block2_out[0][0]',       
                                                                      'conv3_block3_3_bn[0][0]']      
                                                                                                      
     conv3_block3_out (Activation)  (None, 8, 8, 512)    0           ['conv3_block3_add[0][0]']       
                                                                                                      
     conv3_block4_1_conv (Conv2D)   (None, 8, 8, 128)    65664       ['conv3_block3_out[0][0]']       
                                                                                                      
     conv3_block4_1_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block4_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block4_1_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block4_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block4_2_conv (Conv2D)   (None, 8, 8, 128)    147584      ['conv3_block4_1_relu[0][0]']    
                                                                                                      
     conv3_block4_2_bn (BatchNormal  (None, 8, 8, 128)   512         ['conv3_block4_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block4_2_relu (Activatio  (None, 8, 8, 128)   0           ['conv3_block4_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv3_block4_3_conv (Conv2D)   (None, 8, 8, 512)    66048       ['conv3_block4_2_relu[0][0]']    
                                                                                                      
     conv3_block4_3_bn (BatchNormal  (None, 8, 8, 512)   2048        ['conv3_block4_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv3_block4_add (Add)         (None, 8, 8, 512)    0           ['conv3_block3_out[0][0]',       
                                                                      'conv3_block4_3_bn[0][0]']      
                                                                                                      
     conv3_block4_out (Activation)  (None, 8, 8, 512)    0           ['conv3_block4_add[0][0]']       
                                                                                                      
     conv4_block1_1_conv (Conv2D)   (None, 4, 4, 256)    131328      ['conv3_block4_out[0][0]']       
                                                                                                      
     conv4_block1_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block1_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block1_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block1_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block1_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block1_1_relu[0][0]']    
                                                                                                      
     conv4_block1_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block1_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block1_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block1_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block1_0_conv (Conv2D)   (None, 4, 4, 1024)   525312      ['conv3_block4_out[0][0]']       
                                                                                                      
     conv4_block1_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block1_2_relu[0][0]']    
                                                                                                      
     conv4_block1_0_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block1_0_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block1_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block1_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block1_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block1_0_bn[0][0]',      
                                                                      'conv4_block1_3_bn[0][0]']      
                                                                                                      
     conv4_block1_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block1_add[0][0]']       
                                                                                                      
     conv4_block2_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block1_out[0][0]']       
                                                                                                      
     conv4_block2_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block2_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block2_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block2_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block2_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block2_1_relu[0][0]']    
                                                                                                      
     conv4_block2_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block2_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block2_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block2_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block2_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block2_2_relu[0][0]']    
                                                                                                      
     conv4_block2_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block2_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block2_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block1_out[0][0]',       
                                                                      'conv4_block2_3_bn[0][0]']      
                                                                                                      
     conv4_block2_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block2_add[0][0]']       
                                                                                                      
     conv4_block3_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block2_out[0][0]']       
                                                                                                      
     conv4_block3_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block3_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block3_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block3_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block3_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block3_1_relu[0][0]']    
                                                                                                      
     conv4_block3_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block3_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block3_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block3_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block3_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block3_2_relu[0][0]']    
                                                                                                      
     conv4_block3_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block3_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block3_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block2_out[0][0]',       
                                                                      'conv4_block3_3_bn[0][0]']      
                                                                                                      
     conv4_block3_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block3_add[0][0]']       
                                                                                                      
     conv4_block4_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block3_out[0][0]']       
                                                                                                      
     conv4_block4_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block4_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block4_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block4_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block4_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block4_1_relu[0][0]']    
                                                                                                      
     conv4_block4_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block4_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block4_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block4_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block4_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block4_2_relu[0][0]']    
                                                                                                      
     conv4_block4_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block4_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block4_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block3_out[0][0]',       
                                                                      'conv4_block4_3_bn[0][0]']      
                                                                                                      
     conv4_block4_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block4_add[0][0]']       
                                                                                                      
     conv4_block5_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block4_out[0][0]']       
                                                                                                      
     conv4_block5_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block5_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block5_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block5_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block5_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block5_1_relu[0][0]']    
                                                                                                      
     conv4_block5_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block5_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block5_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block5_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block5_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block5_2_relu[0][0]']    
                                                                                                      
     conv4_block5_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block5_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block5_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block4_out[0][0]',       
                                                                      'conv4_block5_3_bn[0][0]']      
                                                                                                      
     conv4_block5_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block5_add[0][0]']       
                                                                                                      
     conv4_block6_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block5_out[0][0]']       
                                                                                                      
     conv4_block6_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block6_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block6_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block6_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block6_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block6_1_relu[0][0]']    
                                                                                                      
     conv4_block6_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block6_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block6_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block6_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block6_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block6_2_relu[0][0]']    
                                                                                                      
     conv4_block6_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block6_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block6_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block5_out[0][0]',       
                                                                      'conv4_block6_3_bn[0][0]']      
                                                                                                      
     conv4_block6_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block6_add[0][0]']       
                                                                                                      
     conv4_block7_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block6_out[0][0]']       
                                                                                                      
     conv4_block7_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block7_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block7_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block7_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block7_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block7_1_relu[0][0]']    
                                                                                                      
     conv4_block7_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block7_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block7_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block7_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block7_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block7_2_relu[0][0]']    
                                                                                                      
     conv4_block7_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block7_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block7_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block6_out[0][0]',       
                                                                      'conv4_block7_3_bn[0][0]']      
                                                                                                      
     conv4_block7_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block7_add[0][0]']       
                                                                                                      
     conv4_block8_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block7_out[0][0]']       
                                                                                                      
     conv4_block8_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block8_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block8_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block8_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block8_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block8_1_relu[0][0]']    
                                                                                                      
     conv4_block8_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block8_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block8_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block8_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block8_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block8_2_relu[0][0]']    
                                                                                                      
     conv4_block8_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block8_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block8_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block7_out[0][0]',       
                                                                      'conv4_block8_3_bn[0][0]']      
                                                                                                      
     conv4_block8_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block8_add[0][0]']       
                                                                                                      
     conv4_block9_1_conv (Conv2D)   (None, 4, 4, 256)    262400      ['conv4_block8_out[0][0]']       
                                                                                                      
     conv4_block9_1_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block9_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block9_1_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block9_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block9_2_conv (Conv2D)   (None, 4, 4, 256)    590080      ['conv4_block9_1_relu[0][0]']    
                                                                                                      
     conv4_block9_2_bn (BatchNormal  (None, 4, 4, 256)   1024        ['conv4_block9_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block9_2_relu (Activatio  (None, 4, 4, 256)   0           ['conv4_block9_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv4_block9_3_conv (Conv2D)   (None, 4, 4, 1024)   263168      ['conv4_block9_2_relu[0][0]']    
                                                                                                      
     conv4_block9_3_bn (BatchNormal  (None, 4, 4, 1024)  4096        ['conv4_block9_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv4_block9_add (Add)         (None, 4, 4, 1024)   0           ['conv4_block8_out[0][0]',       
                                                                      'conv4_block9_3_bn[0][0]']      
                                                                                                      
     conv4_block9_out (Activation)  (None, 4, 4, 1024)   0           ['conv4_block9_add[0][0]']       
                                                                                                      
     conv4_block10_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block9_out[0][0]']       
                                                                                                      
     conv4_block10_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block10_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block10_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block10_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block10_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block10_1_relu[0][0]']   
                                                                                                      
     conv4_block10_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block10_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block10_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block10_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block10_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block10_2_relu[0][0]']   
                                                                                                      
     conv4_block10_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block10_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block10_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block9_out[0][0]',       
                                                                      'conv4_block10_3_bn[0][0]']     
                                                                                                      
     conv4_block10_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block10_add[0][0]']      
                                                                                                      
     conv4_block11_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block10_out[0][0]']      
                                                                                                      
     conv4_block11_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block11_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block11_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block11_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block11_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block11_1_relu[0][0]']   
                                                                                                      
     conv4_block11_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block11_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block11_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block11_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block11_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block11_2_relu[0][0]']   
                                                                                                      
     conv4_block11_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block11_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block11_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block10_out[0][0]',      
                                                                      'conv4_block11_3_bn[0][0]']     
                                                                                                      
     conv4_block11_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block11_add[0][0]']      
                                                                                                      
     conv4_block12_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block11_out[0][0]']      
                                                                                                      
     conv4_block12_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block12_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block12_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block12_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block12_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block12_1_relu[0][0]']   
                                                                                                      
     conv4_block12_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block12_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block12_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block12_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block12_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block12_2_relu[0][0]']   
                                                                                                      
     conv4_block12_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block12_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block12_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block11_out[0][0]',      
                                                                      'conv4_block12_3_bn[0][0]']     
                                                                                                      
     conv4_block12_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block12_add[0][0]']      
                                                                                                      
     conv4_block13_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block12_out[0][0]']      
                                                                                                      
     conv4_block13_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block13_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block13_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block13_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block13_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block13_1_relu[0][0]']   
                                                                                                      
     conv4_block13_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block13_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block13_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block13_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block13_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block13_2_relu[0][0]']   
                                                                                                      
     conv4_block13_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block13_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block13_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block12_out[0][0]',      
                                                                      'conv4_block13_3_bn[0][0]']     
                                                                                                      
     conv4_block13_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block13_add[0][0]']      
                                                                                                      
     conv4_block14_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block13_out[0][0]']      
                                                                                                      
     conv4_block14_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block14_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block14_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block14_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block14_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block14_1_relu[0][0]']   
                                                                                                      
     conv4_block14_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block14_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block14_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block14_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block14_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block14_2_relu[0][0]']   
                                                                                                      
     conv4_block14_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block14_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block14_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block13_out[0][0]',      
                                                                      'conv4_block14_3_bn[0][0]']     
                                                                                                      
     conv4_block14_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block14_add[0][0]']      
                                                                                                      
     conv4_block15_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block14_out[0][0]']      
                                                                                                      
     conv4_block15_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block15_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block15_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block15_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block15_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block15_1_relu[0][0]']   
                                                                                                      
     conv4_block15_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block15_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block15_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block15_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block15_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block15_2_relu[0][0]']   
                                                                                                      
     conv4_block15_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block15_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block15_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block14_out[0][0]',      
                                                                      'conv4_block15_3_bn[0][0]']     
                                                                                                      
     conv4_block15_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block15_add[0][0]']      
                                                                                                      
     conv4_block16_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block15_out[0][0]']      
                                                                                                      
     conv4_block16_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block16_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block16_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block16_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block16_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block16_1_relu[0][0]']   
                                                                                                      
     conv4_block16_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block16_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block16_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block16_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block16_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block16_2_relu[0][0]']   
                                                                                                      
     conv4_block16_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block16_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block16_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block15_out[0][0]',      
                                                                      'conv4_block16_3_bn[0][0]']     
                                                                                                      
     conv4_block16_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block16_add[0][0]']      
                                                                                                      
     conv4_block17_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block16_out[0][0]']      
                                                                                                      
     conv4_block17_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block17_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block17_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block17_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block17_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block17_1_relu[0][0]']   
                                                                                                      
     conv4_block17_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block17_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block17_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block17_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block17_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block17_2_relu[0][0]']   
                                                                                                      
     conv4_block17_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block17_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block17_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block16_out[0][0]',      
                                                                      'conv4_block17_3_bn[0][0]']     
                                                                                                      
     conv4_block17_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block17_add[0][0]']      
                                                                                                      
     conv4_block18_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block17_out[0][0]']      
                                                                                                      
     conv4_block18_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block18_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block18_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block18_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block18_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block18_1_relu[0][0]']   
                                                                                                      
     conv4_block18_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block18_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block18_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block18_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block18_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block18_2_relu[0][0]']   
                                                                                                      
     conv4_block18_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block18_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block18_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block17_out[0][0]',      
                                                                      'conv4_block18_3_bn[0][0]']     
                                                                                                      
     conv4_block18_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block18_add[0][0]']      
                                                                                                      
     conv4_block19_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block18_out[0][0]']      
                                                                                                      
     conv4_block19_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block19_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block19_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block19_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block19_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block19_1_relu[0][0]']   
                                                                                                      
     conv4_block19_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block19_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block19_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block19_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block19_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block19_2_relu[0][0]']   
                                                                                                      
     conv4_block19_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block19_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block19_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block18_out[0][0]',      
                                                                      'conv4_block19_3_bn[0][0]']     
                                                                                                      
     conv4_block19_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block19_add[0][0]']      
                                                                                                      
     conv4_block20_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block19_out[0][0]']      
                                                                                                      
     conv4_block20_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block20_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block20_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block20_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block20_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block20_1_relu[0][0]']   
                                                                                                      
     conv4_block20_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block20_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block20_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block20_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block20_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block20_2_relu[0][0]']   
                                                                                                      
     conv4_block20_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block20_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block20_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block19_out[0][0]',      
                                                                      'conv4_block20_3_bn[0][0]']     
                                                                                                      
     conv4_block20_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block20_add[0][0]']      
                                                                                                      
     conv4_block21_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block20_out[0][0]']      
                                                                                                      
     conv4_block21_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block21_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block21_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block21_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block21_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block21_1_relu[0][0]']   
                                                                                                      
     conv4_block21_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block21_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block21_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block21_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block21_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block21_2_relu[0][0]']   
                                                                                                      
     conv4_block21_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block21_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block21_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block20_out[0][0]',      
                                                                      'conv4_block21_3_bn[0][0]']     
                                                                                                      
     conv4_block21_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block21_add[0][0]']      
                                                                                                      
     conv4_block22_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block21_out[0][0]']      
                                                                                                      
     conv4_block22_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block22_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block22_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block22_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block22_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block22_1_relu[0][0]']   
                                                                                                      
     conv4_block22_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block22_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block22_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block22_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block22_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block22_2_relu[0][0]']   
                                                                                                      
     conv4_block22_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block22_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block22_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block21_out[0][0]',      
                                                                      'conv4_block22_3_bn[0][0]']     
                                                                                                      
     conv4_block22_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block22_add[0][0]']      
                                                                                                      
     conv4_block23_1_conv (Conv2D)  (None, 4, 4, 256)    262400      ['conv4_block22_out[0][0]']      
                                                                                                      
     conv4_block23_1_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block23_1_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block23_1_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block23_1_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block23_2_conv (Conv2D)  (None, 4, 4, 256)    590080      ['conv4_block23_1_relu[0][0]']   
                                                                                                      
     conv4_block23_2_bn (BatchNorma  (None, 4, 4, 256)   1024        ['conv4_block23_2_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block23_2_relu (Activati  (None, 4, 4, 256)   0           ['conv4_block23_2_bn[0][0]']     
     on)                                                                                              
                                                                                                      
     conv4_block23_3_conv (Conv2D)  (None, 4, 4, 1024)   263168      ['conv4_block23_2_relu[0][0]']   
                                                                                                      
     conv4_block23_3_bn (BatchNorma  (None, 4, 4, 1024)  4096        ['conv4_block23_3_conv[0][0]']   
     lization)                                                                                        
                                                                                                      
     conv4_block23_add (Add)        (None, 4, 4, 1024)   0           ['conv4_block22_out[0][0]',      
                                                                      'conv4_block23_3_bn[0][0]']     
                                                                                                      
     conv4_block23_out (Activation)  (None, 4, 4, 1024)  0           ['conv4_block23_add[0][0]']      
                                                                                                      
     conv5_block1_1_conv (Conv2D)   (None, 2, 2, 512)    524800      ['conv4_block23_out[0][0]']      
                                                                                                      
     conv5_block1_1_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block1_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block1_1_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block1_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block1_2_conv (Conv2D)   (None, 2, 2, 512)    2359808     ['conv5_block1_1_relu[0][0]']    
                                                                                                      
     conv5_block1_2_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block1_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block1_2_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block1_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block1_0_conv (Conv2D)   (None, 2, 2, 2048)   2099200     ['conv4_block23_out[0][0]']      
                                                                                                      
     conv5_block1_3_conv (Conv2D)   (None, 2, 2, 2048)   1050624     ['conv5_block1_2_relu[0][0]']    
                                                                                                      
     conv5_block1_0_bn (BatchNormal  (None, 2, 2, 2048)  8192        ['conv5_block1_0_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block1_3_bn (BatchNormal  (None, 2, 2, 2048)  8192        ['conv5_block1_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block1_add (Add)         (None, 2, 2, 2048)   0           ['conv5_block1_0_bn[0][0]',      
                                                                      'conv5_block1_3_bn[0][0]']      
                                                                                                      
     conv5_block1_out (Activation)  (None, 2, 2, 2048)   0           ['conv5_block1_add[0][0]']       
                                                                                                      
     conv5_block2_1_conv (Conv2D)   (None, 2, 2, 512)    1049088     ['conv5_block1_out[0][0]']       
                                                                                                      
     conv5_block2_1_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block2_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block2_1_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block2_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block2_2_conv (Conv2D)   (None, 2, 2, 512)    2359808     ['conv5_block2_1_relu[0][0]']    
                                                                                                      
     conv5_block2_2_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block2_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block2_2_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block2_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block2_3_conv (Conv2D)   (None, 2, 2, 2048)   1050624     ['conv5_block2_2_relu[0][0]']    
                                                                                                      
     conv5_block2_3_bn (BatchNormal  (None, 2, 2, 2048)  8192        ['conv5_block2_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block2_add (Add)         (None, 2, 2, 2048)   0           ['conv5_block1_out[0][0]',       
                                                                      'conv5_block2_3_bn[0][0]']      
                                                                                                      
     conv5_block2_out (Activation)  (None, 2, 2, 2048)   0           ['conv5_block2_add[0][0]']       
                                                                                                      
     conv5_block3_1_conv (Conv2D)   (None, 2, 2, 512)    1049088     ['conv5_block2_out[0][0]']       
                                                                                                      
     conv5_block3_1_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block3_1_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block3_1_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block3_1_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block3_2_conv (Conv2D)   (None, 2, 2, 512)    2359808     ['conv5_block3_1_relu[0][0]']    
                                                                                                      
     conv5_block3_2_bn (BatchNormal  (None, 2, 2, 512)   2048        ['conv5_block3_2_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block3_2_relu (Activatio  (None, 2, 2, 512)   0           ['conv5_block3_2_bn[0][0]']      
     n)                                                                                               
                                                                                                      
     conv5_block3_3_conv (Conv2D)   (None, 2, 2, 2048)   1050624     ['conv5_block3_2_relu[0][0]']    
                                                                                                      
     conv5_block3_3_bn (BatchNormal  (None, 2, 2, 2048)  8192        ['conv5_block3_3_conv[0][0]']    
     ization)                                                                                         
                                                                                                      
     conv5_block3_add (Add)         (None, 2, 2, 2048)   0           ['conv5_block2_out[0][0]',       
                                                                      'conv5_block3_3_bn[0][0]']      
                                                                                                      
     conv5_block3_out (Activation)  (None, 2, 2, 2048)   0           ['conv5_block3_add[0][0]']       
                                                                                                      
     global_average_pooling2d_1 (Gl  (None, 2048)        0           ['conv5_block3_out[0][0]']       
     obalAveragePooling2D)                                                                            
                                                                                                      
     dense_2 (Dense)                (None, 1024)         2098176     ['global_average_pooling2d_1[0][0
                                                                     ]']                              
                                                                                                      
     dropout_1 (Dropout)            (None, 1024)         0           ['dense_2[0][0]']                
                                                                                                      
     dense_3 (Dense)                (None, 200)          205000      ['dropout_1[0][0]']              
                                                                                                      
    ==================================================================================================
    Total params: 44,961,352
    Trainable params: 44,856,008
    Non-trainable params: 105,344
    __________________________________________________________________________________________________
    None



```python
# Train the model
with tf.device('/device:GPU:0'):
    history = model6.fit(train_generator,
                        epochs=15,
                        validation_data=val_generator,
                        callbacks=[time_callback, tf.keras.callbacks.TensorBoard(log_dir='./logs')])
```

    Epoch 1/15
    1563/1563 [==============================] - 381s 237ms/step - loss: 3.4322 - accuracy: 0.2747 - val_loss: 2.2370 - val_accuracy: 0.4663
    Epoch 2/15
    1563/1563 [==============================] - 365s 233ms/step - loss: 2.0805 - accuracy: 0.5015 - val_loss: 2.0029 - val_accuracy: 0.5235
    Epoch 3/15
    1563/1563 [==============================] - 363s 232ms/step - loss: 1.6227 - accuracy: 0.5986 - val_loss: 1.8773 - val_accuracy: 0.5395
    Epoch 4/15
    1563/1563 [==============================] - 362s 232ms/step - loss: 1.3010 - accuracy: 0.6671 - val_loss: 1.9223 - val_accuracy: 0.5489
    Epoch 5/15
    1563/1563 [==============================] - 362s 232ms/step - loss: 1.0509 - accuracy: 0.7246 - val_loss: 1.9876 - val_accuracy: 0.5406
    Epoch 6/15
    1563/1563 [==============================] - 364s 233ms/step - loss: 0.8478 - accuracy: 0.7735 - val_loss: 2.0723 - val_accuracy: 0.5532
    Epoch 7/15
    1563/1563 [==============================] - 362s 232ms/step - loss: 0.6897 - accuracy: 0.8113 - val_loss: 2.0589 - val_accuracy: 0.5498
    Epoch 8/15
    1563/1563 [==============================] - 363s 233ms/step - loss: 0.5699 - accuracy: 0.8409 - val_loss: 2.1778 - val_accuracy: 0.5487
    Epoch 9/15
    1563/1563 [==============================] - 362s 232ms/step - loss: 0.4821 - accuracy: 0.8636 - val_loss: 2.1881 - val_accuracy: 0.5507
    Epoch 10/15
    1563/1563 [==============================] - 363s 233ms/step - loss: 0.4213 - accuracy: 0.8800 - val_loss: 2.2289 - val_accuracy: 0.5505
    Epoch 11/15
    1563/1563 [==============================] - 364s 233ms/step - loss: 0.3673 - accuracy: 0.8935 - val_loss: 2.3453 - val_accuracy: 0.5432
    Epoch 12/15
    1563/1563 [==============================] - 361s 231ms/step - loss: 0.3172 - accuracy: 0.9058 - val_loss: 2.4139 - val_accuracy: 0.5423
    Epoch 13/15
    1563/1563 [==============================] - 361s 231ms/step - loss: 0.2944 - accuracy: 0.9131 - val_loss: 2.5502 - val_accuracy: 0.5351
    Epoch 14/15
    1563/1563 [==============================] - 366s 234ms/step - loss: 0.2622 - accuracy: 0.9216 - val_loss: 2.4279 - val_accuracy: 0.5477
    Epoch 15/15
    1563/1563 [==============================] - 363s 232ms/step - loss: 0.2390 - accuracy: 0.9280 - val_loss: 2.5798 - val_accuracy: 0.5337



```python
total_time = sum(time_callback.times)
print(f"Total execution time: {total_time:.2f} seconds")
```

    Total execution time: 5463.40 seconds



```python

```
